<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0051)https://shamil-ahmadullin.ru/upr/find_letters6.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <title>Таблице Шульте (клик)| Упражнения скорочтения для детей.</title>
        <script src="./2_files/jquery.min.js"></script>
        <link rel="stylesheet" href="./2_files/style.css">
        <link rel="stylesheet" href="./2_files/tablestyle10.css">
    </head>
    <body onload="init_table_size()">
        <div class="main">
            <div id="settings">
                <table align="center" bgcolor="#3281FF" cellspacing="15" cellpadding="2">
                    <tbody><tr>
                        <td>
                            <select title="Кол-во букв" name="speedsize" id="letter_count" onchange="set_letter_count()">
                                <option disabled="" selected="" value="1">Кол-во букв </option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                            </select>
                        </td>
                    </tr>
                </tbody></table>
            </div>

            <div id="user_task" class="top-text">Здесь будут буквы котрые нужно искать.</div>
            <div id="here_table"><table id="match_table"><tr><td class="shulte_table" id="t1" style="height: 97.8708px;">Л</td><td class="shulte_table" id="t2" style="height: 97.8708px;">Р</td><td class="shulte_table" id="t3" style="height: 97.8708px;">Ц</td><td class="shulte_table" id="t4" style="height: 97.8708px;">Ш</td><td class="shulte_table" id="t5" style="height: 97.8708px;">Ж</td><td class="shulte_table" id="t6" style="height: 97.8961px;">Е</td></tr><tr><td class="shulte_table" id="t7" style="height: 97.8708px;">Х</td><td class="shulte_table" id="t8" style="height: 97.8708px;">В</td><td class="shulte_table" id="t9" style="height: 97.8708px;">В</td><td class="shulte_table" id="t10" style="height: 97.8708px;">Я</td><td class="shulte_table" id="t11" style="height: 97.8708px;">И</td><td class="shulte_table" id="t12" style="height: 97.8961px;">Х</td></tr><tr><td class="shulte_table" id="t13" style="height: 97.8708px;">Ж</td><td class="shulte_table" id="t14" style="height: 97.8708px;">Ш</td><td class="shulte_table" id="t15" style="height: 97.8708px;">Р</td><td class="shulte_table" id="t16" style="height: 97.8708px;">М</td><td class="shulte_table" id="t17" style="height: 97.8708px;">Ъ</td><td class="shulte_table" id="t18" style="height: 97.8961px;">Ю</td></tr><tr><td class="shulte_table" id="t19" style="height: 97.8708px;">О</td><td class="shulte_table" id="t20" style="height: 97.8708px;">Я</td><td class="shulte_table" id="t21" style="height: 97.8708px;">Ж</td><td class="shulte_table" id="t22" style="height: 97.8708px;">Т</td><td class="shulte_table" id="t23" style="height: 97.8708px;">Ё</td><td class="shulte_table" id="t24" style="height: 97.8961px;">Л</td></tr><tr><td class="shulte_table" id="t25" style="height: 97.8708px;">Ю</td><td class="shulte_table" id="t26" style="height: 97.8708px;">Л</td><td class="shulte_table" id="t27" style="height: 97.8708px;">Ш</td><td class="shulte_table" id="t28" style="height: 97.8708px;">Л</td><td class="shulte_table" id="t29" style="height: 97.8708px;">Т</td><td class="shulte_table" id="t30" style="height: 97.8961px;">Ч</td></tr><tr><td class="shulte_table" id="t31" style="height: 97.8708px;">К</td><td class="shulte_table" id="t32" style="height: 97.8708px;">С</td><td class="shulte_table" id="t33" style="height: 97.8708px;">У</td><td class="shulte_table" id="t34" style="height: 97.8708px;">П</td><td class="shulte_table" id="t35" style="height: 97.8708px;">У</td><td class="shulte_table" id="t36" style="height: 97.8961px;">Ё</td></tr></table></div>
            <button class="knopka" id="gen">Начать упражнение!</button>
            <div id="timer" style="margin: 20px 0; font-size: 29px; text-align: center;"></div>
        </div>
        <h3 style="margin-top: 30px; padding: 0; text-align: center; font-size: 27px; line-height: 30px; font-weight: 800;">Ваши результаты:</h3>
        <div id="user_res_time" style="text-align: center; font-size: 25px;"></div>
    

    <script type="text/javascript">
        var n = 6,
            m = 6;
        let chars = ["а", "б", "в", "г", "д", "е", "ё", "ж", "з", "и", "й", "к", "л", "м", "н", "о", "п", "р", "с", "т", "у", "ф", "х", "ц", "ч", "ш", "щ", "ъ", "ы", "ь", "э", "ю", "я"];
        var free = new Array(n * m);
        let task = [];
        var task_kol = 0;
        var tec = 0;
        var instance = new sh_match();
        var letter_count = 1;
		
		function shuffle(array) {
		  array.sort(() => Math.random() - 0.5);
		}

        function set_letter_count() {
            letter_count = Number($("#letter_count :selected").val());
        }

        function init_table_size() {
            for (var i = 1; i <= n * m; i++) $("#t" + i).css("height", $("#t" + i).width() * 0.81);
        }
        $(window).resize(init_table_size);

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function getRandomChar() {
            return chars[Math.floor(Math.random() * chars.length)].toUpperCase();
        }

        function swap(a, i1, i2) {
            var t = a[i1];
            a[i1] = a[i2];
            a[i2] = t;
        }

        function how_many_in_array(a) {
            return free.filter(function (x) {
                return x == a;
            }).length;
        }


		
		function at(x,a,b){
		return !(x>=a && x<=b)
		}

        function make_targets(targets) {
            var min_letter, max_letter;
            var c = 0;
            task = [];
            task_kol = 0;
            switch (targets) {
                case 1:
                    min_letter = 7;
                    max_letter = 10;
                    break;

                case 2:
                    min_letter = 5;
                    max_letter = 7;
                    break;

                case 3:
                    min_letter = 3;
                    max_letter = 5;
                    break;
            }
			
				while (task.length< targets) {
				x = getRandomChar();
				if (task.indexOf(x) != -1) { continue }
				task.push(x);
					
                }
				
				for(let jjj =0 ; jjj< 4; jjj++){
				for(let jj =0 ; jj< targets; jj++)
				{
				while(at(how_many_in_array(task[jj]),min_letter,max_letter))
				{
				free.shift();
				free.push(task[jj]);
				}
				}
				}
			console.log(task)
			console.log(free)
			
			for(let jj =0 ; jj< targets; jj++)
				{task_kol+=how_many_in_array(task[jj])
				}
				
				shuffle(free)
			
				
        }

        function filltable_chars() {
            for (i = 0; i < n * m; i++) free[i] = getRandomChar();

            make_targets(letter_count);

            for (i = 1; i < n * m + 1; i++) document.getElementById("t" + i).innerHTML = free[i - 1];
            document.getElementById("match_table").style.opacity = 1.0;
            $("#gen").hide();
        }

        let clickCount = 0;
        let resTime;
        let trueClick = 0;
        let falseClick = 0;

        document.body.addEventListener('mousedown', function() {
            if (instance.started) {
                clickCount++;
            }
        });

        $(document).ready(function () {
            $(".shulte_table").click(function () {
                if (instance.started) {
                    current_id = $(this).attr("id");

                    current_id_num = current_id.substr(1);

                    if (task.indexOf(free[current_id_num - 1]) != -1) {
                        tec++;
                        trueClick++;
                        $("#" + current_id).fadeTo(0, 0.3);

                        if (tec == task_kol) {
                            instance.stop_match();
                            window.parent.postMessage({ 
                                status: true,
                                type: 'end',
                                info: {
                                    clickCount: clickCount,
                                    resTime: resTime,
                                    trueClick: trueClick,
                                    falseClick: falseClick 
                                }    
                            }, '*');

                            return false;
                        }
                    } else {
                        falseClick++;
                        $("#" + current_id)
                            .animate({ fontSize: "150%" }, 250)
                            .animate({ fontSize: "100%" }, 150);
                    }
                }
            });
        });

        function sh_match() {
            var oldthis = this;
            this.started = false;

            this.staring = function () {
                tec = 0;
                $(".shulte_table").fadeTo(0, 1);
                this.started = true;
                filltable_chars();
                document.getElementById("user_task").innerHTML = "Найдите буквы:" + task.join();
                this.timer = setInterval(this.show_tick_time, 100);
                this.starttime = new Date();
            };
            this.show_tick_time = function () {
                document.getElementById("timer").innerHTML = "Время: " + Math.floor((new Date() - oldthis.starttime) / 100) / 10 + " сек.";
            };

            this.stop_match = function () {
                clearInterval(oldthis.timer);
                oldthis.started = false;
                resTime = Math.floor((new Date() - oldthis.starttime) / 100) / 10;
                document.getElementById("user_res_time").innerHTML = new Date().toLocaleString() + " &mdash; " + Math.floor((new Date() - oldthis.starttime) / 100) / 10 + " сек.<br />" + document.getElementById("user_res_time").innerHTML;
                $("#gen").show();
                document.getElementById("match_table").style.opacity = 0.2;
            };
        }

        $(document).ready(function () {
            document.getElementById("gen").onclick = function ttt() {
                
                window.parent.postMessage({ 
                    status: true,
                    type: 'start'  
                }, '*');

                if (instance.started) instance.stop_match();
                else instance.staring();
            };
        });

        function add_html_table(w, h) {
            count_id = 1;

            var table = $("<table>").attr("id", "match_table");
            for (i = 0; i < h; i++) {
                var row = "";

                for (j = 0; j < w; j++) {
                    var cell = "";
                    cell = '<td class="shulte_table" id="t' + count_id + '">' + getRandomChar() + "</td>";
                    count_id++;
                    row += cell;
                }
                table.append("<tr>" + row + "</tr>");
            }

            $("#here_table").append(table);
        }
    </script>

</body></html>